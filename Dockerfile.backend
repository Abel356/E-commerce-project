FROM node:20-slim

WORKDIR /app

# Copy backend package files
COPY backend/package*.json ./backend/

# Install backend dependencies
RUN cd backend && npm ci

# Copy backend source
COPY backend ./backend

# Generate Prisma client
RUN cd backend && npx prisma generate

# Create folder for SQLite persistence
RUN mkdir -p /data

ENV PORT=8080
EXPOSE 8080

# IMPORTANT: listen on 0.0.0.0 inside container
CMD ["sh", "-c", "cd backend && npm run dev -- --host 0.0.0.0 --port 8080"]